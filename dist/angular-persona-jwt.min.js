!function(n){"use strict";n.module("angular-persona-jwt",["angular-persona-jwt.services","angular-persona-jwt.directives"])}(angular),function(n){"use strict";function o(n){function o(){n.navigator.id.request()}return{restrict:"EA",scope:{onLogin:"=",onLogout:"="},transclude:!0,controller:["$scope","persona",function(n,e){this.login=o,n.$watch(function(){return e},function(){e.loggedUser&&n.onLogin&&n.onLogin()},!0)}],controllerAs:"persona",template:'<div ng-transclude ng-click="persona.login()"></div>'}}function e(n){function o(){n.navigator.id.logout()}return{restrict:"EA",transclude:!0,scope:{},controller:function(){this.logout=o},controllerAs:"persona",template:'<div ng-transclude ng-click="persona.logout()"></div>'}}o.$inject=["$window","persona"],e.$inject=["$window","persona"],n.module("angular-persona-jwt.directives",[]).directive("personaLogin",o).directive("personaLogout",e)}(angular),function(n){"use strict";function o(o,e){function t(o){var e={},t=[],a=[],c=[];return e.addLoginListener=function(n){t.push(n)},e.addLogoutListener=function(n){a.push(n)},e.addLoginFailListener=function(n){c.push(n)},e.login=function(a){var s={assertion:a,audience:i.audience};o.post(i.baseUrl+"/login",s).success(function(o){e.loggedUser=o.user,r.localStorage.setItem(i.tokenStorageKey,o.token),n.forEach(t,function(n){n(o.user)})}).error(function(o){console.log("Login failed :",o.message),n.forEach(c,function(n){n()})})},e.logout=function(){e.loggedUser=null,r.localStorage.removeItem(i.tokenStorageKey),n.forEach(a,function(n){n()})},r.navigator.id.watch({loggedInUser:e.loggedUser,onlogin:e.login,onlogout:e.logout}),e}var r=o.$get(),i={baseUrl:"localhost",audience:r.location.href,tokenStorageKey:"angular-persona-jwt-token"};this.config=function(o){i=n.extend(i,o),e.interceptors.push(["$q",function(n){return{request:function(n){var o=r.localStorage.getItem(i.tokenStorageKey);return o&&(n.headers.Authorization="Bearer "+o),n},responseError:function(o){return n.reject(o)}}}])},t.$inject=["$http"],this.$get=t}o.$inject=["$windowProvider","$httpProvider"],n.module("angular-persona-jwt.services",[]).provider("persona",o)}(angular);