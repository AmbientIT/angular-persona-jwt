!function(n){"use strict";function e(n){function e(){n.navigator.id.request()}return{restrict:"EA",scope:{onLogin:"=",onLogout:"="},transclude:!0,controller:["$scope","persona",function(n,o){this.login=e,n.$watch(function(){return o},function(){o.loggedUser&&n.onLogin&&n.onLogin()},!0)}],controllerAs:"persona",template:'<div ng-transclude ng-click="persona.login()"></div>'}}function o(n){function e(){n.navigator.id.logout()}return{restrict:"EA",transclude:!0,scope:{},controller:function(){this.logout=e},controllerAs:"persona",template:'<div ng-transclude ng-click="persona.logout()"></div>'}}function t(e,o){var t=e.$get(),r={baseUrl:"localhost",audience:t.location.href,tokenStorageKey:"angular-persona-jwt-token"};this.config=function(e){r=n.extend(r,e),o.interceptors.push(["$q",function(n){return{request:function(n){var e=t.localStorage.getItem(r.tokenStorageKey);return e&&(n.headers.Authorization="Bearer "+e),n},responseError:function(e){return n.reject(e)}}}])},this.$get=["$http","$q","$document",function(e,o,i){var a=this,s=[],c=[],u=[];return this.addLoginListener=function(n){s.push(n)},this.addLogoutListener=function(n){c.push(n)},this.addLoginFailListener=function(n){u.push(n)},this.login=function(o){var i={assertion:o,audience:r.audience};e.post(r.baseUrl+"/login",i).success(function(e){a.loggedUser=e.user,t.localStorage.setItem(r.tokenStorageKey,e.token),n.forEach(s,function(n){n(e.user)})}).error(function(){n.forEach(u,function(n){n()})})},this.logout=function(){a.loggedUser=null,t.localStorage.removeItem(r.tokenStorageKey),n.forEach(c,function(n){n()})},this.init=function(){var n=o.defer(),e=i[0].createElement("script");e.type="text/javascript",e.async=!0,e.src="https://login.persona.org/include.js";var r=i[0].getElementsByTagName("body")[0];return r.appendChild(e),e.onload=function(){t.navigator.id.watch({loggedInUser:a.loggedUser,onlogin:a.login,onlogout:a.logout}),n.resolve()},n.promise},a}]}n.module("angular-persona-jwt",["angular-persona-jwt.services","angular-persona-jwt.directives"]),e.$inject=["$window","persona"],o.$inject=["$window","persona"],n.module("angular-persona-jwt.directives",[]).directive("personaLogin",e).directive("personaLogout",o),t.$inject=["$windowProvider","$httpProvider"],n.module("angular-persona-jwt.services",[]).provider("persona",t)}(angular);