/**
 * angular-persona-jwt - AngularJS module to authenticate an app with Mozilla Persona
 * @version 0.2.0
 * @link https://github.com/Charl---/angular-persona-jwt
 * @license MIT
*/(function(){"use strict";angular.module("angular-persona-jwt",["angular-persona-jwt.navigator"]).constant("PERSONA_TOKEN_STORAGE_KEY","angular-persona-jwt-token").constant("PERSONA_LOGGED_USER_STORAGE_KEY","angular-persona-jwt-logged-user").provider("persona",function(){var t={};return{config:function(n){t=n?n:{}},$get:["$http","$window","$q","$log","personaNavigator","PERSONA_TOKEN_STORAGE_KEY","PERSONA_LOGGED_USER_STORAGE_KEY",function(n,e,r,o,a,i,u){var g=this,s=null;return g.login=function(){return a.get().then(function(e){var r=t.authBackendUrl?t.authBackendUrl:"";return n.post(r+"/auth/login",{assertion:e})})["catch"](function(t){return r.reject(401===t.status?{message:"Error validating assertion on the server"}:t)}).then(function(t){if(!t.data.token){var n="JWT token is missing";return o.error(n),r.reject({message:n})}return t.data}).then(function(t){return e.localStorage.setItem(i,t.token),e.localStorage.setItem(u,JSON.stringify(t.loggedUser)),t.loggedUser}).then(function(t){return s=t})},g.logout=function(){s=null,e.localStorage.removeItem(i),e.localStorage.removeItem(u)},g.getLoggedUser=function(){return s||(s=JSON.parse(e.localStorage.getItem(u))),s},g}]}}).config(["$httpProvider",function(t){t.interceptors.push(["$window","PERSONA_TOKEN_STORAGE_KEY",function(t,n){return{request:function(e){var r=t.localStorage.getItem(n);return r&&(e.headers.Authorization="Bearer "+r),e}}}])}]),angular.module("angular-persona-jwt.navigator",[]).service("personaNavigator",["$window","$q",function(t,n){this.get=function(){return n(function(n,e){t.navigator.id.get(function(t){t?n(t):e({message:"Invalid Persona credentials"})})})}}]);})();